<div class="space-y-6">
    <!-- Date Filter Component -->
    <app-date-filter (filterChanged)="onFiltrosChanged($event)" (filterReset)="onFiltrosReset()">
    </app-date-filter>

    <!-- Filter Active Indicator -->
    <div *ngIf="filtrosAplicados" class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg">
        <div class="flex items-center justify-between">
            <div class="flex items-center">
                <span class="text-blue-700 font-semibold mr-2 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    Filtros Activos
                </span>
                <span class="text-blue-600 text-sm">Los datos mostrados están filtrados por el período
                    seleccionado</span>
            </div>
        </div>
    </div>

    <!-- Stats Cards Component -->
    <app-stats-cards [ventasHoy]="ventasHoy" [ventasMes]="ventasMes" [totalVentas]="totalVentas"
        [crecimientoVentas]="crecimientoVentas" [productosBajoStockCount]="productosBajoStockCount"
        [productosAgotados]="productosAgotados" [valorTotalInventario]="valorTotalInventario"
        [margenBruto]="margenBruto" [creditosPendientes]="creditosPendientes">
    </app-stats-cards>


    <!-- Gráficos -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div
            class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 p-6 transition-colors duration-200">
            <h3 class="font-bold text-slate-800 dark:text-slate-100 mb-4">Análisis de Ventas</h3>
            <div class="h-64 w-full">
                <canvas baseChart class="w-full h-full block" [data]="barChartData" [options]="barChartOptions"
                    [type]="barChartType">
                </canvas>
            </div>
        </div>

        <div
            class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 p-6 transition-colors duration-200">
            <h3 class="font-bold text-slate-800 dark:text-slate-100 mb-4">Top Stock</h3>
            <div class="h-64 w-full">
                <canvas baseChart class="w-full h-full block" [data]="pieChartData" [options]="pieChartOptions"
                    [type]="pieChartType">
                </canvas>
            </div>
        </div>
    </div>



    <!-- Nuevos Gráficos: Tendencia y Categorías -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div
            class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 p-6 transition-colors duration-200">
            <h3 class="font-bold text-slate-800 dark:text-slate-100 mb-4">Tendencia de Ventas (7 Días)</h3>
            <div class="h-64 w-full">
                <canvas baseChart class="w-full h-full block" [data]="lineChartData" [options]="lineChartOptions"
                    [type]="lineChartType">
                </canvas>
            </div>
        </div>

        <div
            class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 p-6 transition-colors duration-200">
            <h3 class="font-bold text-slate-800 dark:text-slate-100 mb-4">Valor de Inventario por Categoría</h3>
            <div class="h-64 w-full">
                <canvas baseChart class="w-full h-full block" [data]="categoryChartData"
                    [options]="categoryChartOptions" [type]="categoryChartType">
                </canvas>
            </div>
        </div>
    </div>

    <!-- Comparativa y Top Proveedores -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div
            class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 p-6 transition-colors duration-200">
            <h3 class="font-bold text-slate-800 dark:text-slate-100 mb-4">Ventas vs Compras (6 Meses)</h3>
            <div class="h-64 w-full">
                <canvas baseChart class="w-full h-full block" [data]="comparisonChartData"
                    [options]="comparisonChartOptions" [type]="comparisonChartType">
                </canvas>
            </div>
        </div>

        <div
            class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 p-6 transition-colors duration-200">
            <h3 class="font-bold text-slate-800 dark:text-slate-100 mb-4">Top Proveedores</h3>
            <div class="h-64 w-full">
                <canvas baseChart class="w-full h-full block" [data]="supplierChartData"
                    [options]="supplierChartOptions" [type]="supplierChartType">
                </canvas>
            </div>
        </div>
    </div>



    <!-- Productos Más y Menos Vendidos -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Productos Más Vendidos -->
        <div
            class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden transition-colors duration-200">
            <div class="p-6 border-b border-slate-100 dark:border-slate-700">
                <h3 class="font-bold text-slate-800 dark:text-slate-100">Productos Más Vendidos</h3>
            </div>
            <div *ngIf="isLoading" class="p-6 text-center">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 dark:border-blue-400 mx-auto">
                </div>
            </div>
            <div *ngIf="!isLoading && productosMasVendidos.length === 0"
                class="p-6 text-center text-slate-500 dark:text-slate-400 py-12 flex flex-col items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mb-3 text-slate-300 dark:text-slate-600"
                    fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
                </svg>
                <p>No hay datos de ventas</p>
            </div>
            <div *ngIf="!isLoading && productosMasVendidos.length > 0"
                class="divide-y divide-slate-100 dark:divide-slate-700">
                <div *ngFor="let producto of productosMasVendidos"
                    class="p-4 hover:bg-slate-50 dark:hover:bg-slate-700 transition">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium text-slate-800 dark:text-slate-100">{{
                                getNombreArticulo(producto.articulo_id, producto.articulo) }}</p>
                            <p class="text-sm text-slate-500 dark:text-slate-400">{{ producto.cantidad_vendida }}
                                unidades vendidas</p>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-green-600 dark:text-green-400">{{ producto.total_ventas | moneda
                                }}</p>
                            <p class="text-xs text-slate-500 dark:text-slate-400">Total vendido</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Recent Sales Component -->
            <app-recent-sales [ventas]="ventasRecientes" [isLoading]="isLoading" (viewAll)="navegarAVentas()">
            </app-recent-sales>

            <!-- Low Stock Component -->
            <app-low-stock [productos]="productosBajoStock" [isLoading]="isLoading"
                (viewInventory)="navegarAInventario()">
            </app-low-stock>
        </div>
        <!-- Productos Menos Vendidos -->
        <div
            class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden transition-colors duration-200">
            <div class="p-6 border-b border-slate-100 dark:border-slate-700">
                <h3 class="font-bold text-slate-800 dark:text-slate-100">Productos Menos Vendidos</h3>
            </div>
            <div *ngIf="isLoading" class="p-6 text-center">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 dark:border-blue-400 mx-auto">
                </div>
            </div>
            <div *ngIf="!isLoading && productosMenosVendidos.length === 0"
                class="p-6 text-center text-slate-500 dark:text-slate-400 py-12 flex flex-col items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mb-3 text-slate-300 dark:text-slate-600"
                    fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6" />
                </svg>
                <p>No hay datos de ventas</p>
            </div>
            <div *ngIf="!isLoading && productosMenosVendidos.length > 0"
                class="divide-y divide-slate-100 dark:divide-slate-700">
                <div *ngFor="let producto of productosMenosVendidos"
                    class="p-4 hover:bg-slate-50 dark:hover:bg-slate-700 transition">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium text-slate-800 dark:text-slate-100">{{
                                getNombreArticulo(producto.articulo_id, producto.articulo) }}</p>
                            <p class="text-sm text-slate-500 dark:text-slate-400">{{ producto.cantidad_vendida }}
                                unidades vendidas</p>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-orange-600 dark:text-orange-400">{{ producto.total_ventas |
                                currency }}</p>
                            <p class="text-xs text-slate-500 dark:text-slate-400">Total vendido</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Clientes Más Frecuentes y Productos -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Clientes Más Frecuentes -->
            <div
                class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden transition-colors duration-200">
                <div class="p-6 border-b border-slate-100 dark:border-slate-700">
                    <h3 class="font-bold text-slate-800 dark:text-slate-100">Clientes Más Frecuentes</h3>
                </div>
                <div *ngIf="isLoading" class="p-6 text-center">
                    <div
                        class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 dark:border-blue-400 mx-auto">
                    </div>
                </div>
                <div *ngIf="!isLoading && clientesMasFrecuentes.length === 0"
                    class="p-6 text-center text-slate-500 dark:text-slate-400 py-12 flex flex-col items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mb-3 text-slate-300 dark:text-slate-600"
                        fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                    </svg>
                    <p>No hay datos de clientes</p>
                </div>
                <div *ngIf="!isLoading && clientesMasFrecuentes.length > 0"
                    class="divide-y divide-slate-100 dark:divide-slate-700">
                    <div *ngFor="let cliente of clientesMasFrecuentes"
                        class="p-4 hover:bg-slate-50 dark:hover:bg-slate-700 transition">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-medium text-slate-800 dark:text-slate-100">{{
                                    getNombreCliente(cliente.cliente_id, cliente.cliente) }}</p>
                                <p class="text-sm text-slate-500 dark:text-slate-400">{{ cliente.cantidad_ventas }}
                                    compras
                                </p>
                            </div>
                            <div class="text-right">
                                <p class="font-bold text-slate-800 dark:text-slate-100">{{ cliente.total_gastado |
                                    currency
                                    }}</p>
                                <p class="text-xs text-slate-500 dark:text-slate-400">Total gastado</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Productos Más Comprados -->
            <div
                class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden transition-colors duration-200">
                <div class="p-6 border-b border-slate-100 dark:border-slate-700">
                    <h3 class="font-bold text-slate-800 dark:text-slate-100">Productos Más Comprados</h3>
                </div>
                <div *ngIf="isLoading" class="p-6 text-center">
                    <div
                        class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 dark:border-blue-400 mx-auto">
                    </div>
                </div>
                <div *ngIf="!isLoading && productosMasComprados.length === 0"
                    class="p-6 text-center text-slate-500 dark:text-slate-400 py-12 flex flex-col items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mb-3 text-slate-300 dark:text-slate-600"
                        fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                    </svg>
                    <p>No hay datos de compras</p>
                </div>
                <div *ngIf="!isLoading && productosMasComprados.length > 0"
                    class="divide-y divide-slate-100 dark:divide-slate-700">
                    <div *ngFor="let producto of productosMasComprados"
                        class="p-4 hover:bg-slate-50 dark:hover:bg-slate-700 transition">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-medium text-slate-800 dark:text-slate-100">{{
                                    getNombreArticulo(producto.articulo_id, producto.articulo) }}</p>
                                <p class="text-sm text-slate-500 dark:text-slate-400">{{ producto.cantidad_comprada }}
                                    unidades compradas</p>
                            </div>
                            <div class="text-right">
                                <p class="font-bold text-slate-800 dark:text-slate-100">{{ producto.total_compras |
                                    currency
                                    }}</p>
                                <p class="text-xs text-slate-500 dark:text-slate-400">Total invertido</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


    </div>

    <!-- Article Profitability Section -->
    <div class="mt-6">
        <app-article-profit [filtros]="filtrosActivos || undefined"></app-article-profit>
    </div>

</div>