<div *ngIf="isOpen"
    class="fixed inset-0 bg-gray-600 dark:bg-slate-900 bg-opacity-50 dark:bg-opacity-75 overflow-y-auto h-full w-full"
    style="z-index: 9999;" (click)="cerrarModal()">
    <div class="relative top-20 mx-auto p-5 border dark:border-slate-700 w-96 shadow-lg rounded-md bg-white dark:bg-slate-800 transition-colors duration-200"
        (click)="$event.stopPropagation()">
        <div class="mt-3" [formGroup]="parentForm">
            <!-- Header del Modal -->
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-slate-100 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600 dark:text-blue-400 mr-2"
                        viewBox="0 0 20 20" fill="currentColor">
                        <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z" />
                        <path fill-rule="evenodd"
                            d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z"
                            clip-rule="evenodd" />
                    </svg>
                    Configurar Venta a Crédito
                </h3>
                <button type="button" (click)="cerrarModal()"
                    class="text-gray-400 dark:text-slate-500 hover:text-gray-600 dark:hover:text-slate-300 transition-colors duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <!-- Contenido del Modal -->
            <div class="space-y-4">
                <div
                    class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3 mb-4 transition-colors duration-200">
                    <p class="text-sm text-blue-800 dark:text-blue-300">
                        Complete la información necesaria para procesar la venta a crédito.
                    </p>
                </div>

                <div>
                    <label for="modal_numero_cuotas"
                        class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1">
                        Número de Cuotas <span class="text-red-500">*</span>
                    </label>
                    <input type="number" id="modal_numero_cuotas" formControlName="numero_cuotas" min="1"
                        class="block w-full py-2 px-3 border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-gray-900 dark:text-slate-100 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                        [class.border-red-500]="parentForm.get('numero_cuotas')?.invalid && parentForm.get('numero_cuotas')?.touched">
                    <p *ngIf="parentForm.get('numero_cuotas')?.invalid && parentForm.get('numero_cuotas')?.touched"
                        class="mt-1 text-xs text-red-600 dark:text-red-400">
                        El número de cuotas es requerido y debe ser mayor a 0
                    </p>
                    <p class="mt-1 text-xs text-gray-500 dark:text-slate-400">
                        Ejemplo: 3 cuotas = el cliente pagará en 3 partes
                    </p>
                </div>

                <div>
                    <label for="modal_tiempo_dias_cuota"
                        class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1">
                        Días entre Cuotas <span class="text-red-500">*</span>
                    </label>
                    <input type="number" id="modal_tiempo_dias_cuota" formControlName="tiempo_dias_cuota" min="1"
                        class="block w-full py-2 px-3 border border-gray-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-gray-900 dark:text-slate-100 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                        [class.border-red-500]="parentForm.get('tiempo_dias_cuota')?.invalid && parentForm.get('tiempo_dias_cuota')?.touched">
                    <p *ngIf="parentForm.get('tiempo_dias_cuota')?.invalid && parentForm.get('tiempo_dias_cuota')?.touched"
                        class="mt-1 text-xs text-red-600 dark:text-red-400">
                        Los días entre cuotas son requeridos y deben ser mayor a 0
                    </p>
                    <p class="mt-1 text-xs text-gray-500 dark:text-slate-400">
                        Ejemplo: 30 días = cuotas mensuales, 15 días = cuotas quincenales
                    </p>
                </div>

                <!-- Información calculada -->
                <div *ngIf="parentForm.get('numero_cuotas')?.value && parentForm.get('tiempo_dias_cuota')?.value && parentForm.get('total')?.value"
                    class="bg-gray-50 dark:bg-slate-700 border border-gray-200 dark:border-slate-600 rounded-lg p-3 transition-colors duration-200">
                    <h4 class="text-sm font-semibold text-gray-700 dark:text-slate-300 mb-2">Resumen del Crédito</h4>
                    <div class="space-y-1 text-sm text-gray-600 dark:text-slate-400">
                        <div class="flex justify-between">
                            <span>Total de la Venta:</span>
                            <span class="font-semibold">{{ parentForm.get('total')?.value | moneda }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Número de Cuotas:</span>
                            <span class="font-semibold">{{ parentForm.get('numero_cuotas')?.value }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Monto por Cuota:</span>
                            <span class="font-semibold text-green-600 dark:text-green-400">
                                {{ (parentForm.get('total')?.value / parentForm.get('numero_cuotas')?.value) | moneda
                                }}
                            </span>
                        </div>
                        <div class="flex justify-between">
                            <span>Días entre Cuotas:</span>
                            <span class="font-semibold">{{ parentForm.get('tiempo_dias_cuota')?.value }} días</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer del Modal -->
            <div class="mt-6 flex justify-end space-x-3">
                <button type="button" (click)="cerrarModal()"
                    class="px-4 py-2 border border-gray-300 dark:border-slate-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-slate-300 bg-white dark:bg-slate-700 hover:bg-gray-50 dark:hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200">
                    Cancelar
                </button>
                <button type="button" (click)="guardarDatosCredito()"
                    [disabled]="parentForm.get('numero_cuotas')?.invalid || parentForm.get('tiempo_dias_cuota')?.invalid"
                    class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed">
                    Guardar
                </button>
            </div>
        </div>
    </div>
</div>